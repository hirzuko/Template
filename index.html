<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user.username }} - VPN Subscription</title>
    <link href="https://fonts.googleapis.com/css2?family=Alata&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script>
        var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}
        const linkFull = "{{ user.subscription_url }}";
        var qrLink = linkFull;
        const link64 = Base64.encode(linkFull);
        const subname = "{{ user.username }}";
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #1a1a1a;
            font-family: 'Alata', sans-serif;
            padding: 20px;
        }
        .container {
            width: 591px;
            max-width: 100%;
            height: 980px;
            background: #D4D4D4;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            border-radius: 8px;
        }
        
        /* Trees background */
        .tree {
            position: absolute;
            background: rgba(65, 127, 60, 0.32);
        }
        .tree-shadow {
            position: absolute;
            background: #D4D4D4;
            transform-origin: top left;
        }
        .tree1 { width: 68px; height: 95px; left: 406px; top: 102px; }
        .shadow1 { width: 90.68px; height: 39.25px; left: 386px; top: 107.34px; transform: rotate(-30deg); }
        .tree2 { width: 68px; height: 75px; left: 324px; top: 121px; }
        .shadow2 { width: 85.22px; height: 39.90px; left: 304.40px; top: 130.13px; transform: rotate(-30deg); }
        .tree3 { width: 68px; height: 75px; left: 248px; top: 122px; }
        .shadow3 { width: 78.93px; height: 34.47px; left: 230.37px; top: 130.71px; transform: rotate(-30deg); }
        .tree4 { width: 68px; height: 95px; left: 172px; top: 101px; }
        .shadow4 { width: 90.68px; height: 39.25px; left: 150.96px; top: 112.66px; transform: rotate(-30deg); }
        .tree5 { width: 68px; height: 75px; left: 96px; top: 121px; }
        .shadow5 { width: 85.77px; height: 49.73px; left: 71.33px; top: 132.89px; transform: rotate(-30deg); }
        .tree6 { width: 68px; height: 68px; left: 20px; top: 128px; }
        .shadow6 { width: 85px; height: 38.04px; left: 0.75px; top: 140.52px; transform: rotate(-30deg); }
        
        .ground-shadow {
            width: 454px;
            height: 8px;
            left: 20px;
            top: 196px;
            position: absolute;
            background: #D9D9D9;
            box-shadow: 10.6px 10.6px 10.6px rgba(0,0,0,0.3);
            filter: blur(5.3px);
        }
        
        /* Logo */
        .logo-container {
            width: 150px;
            height: 150px;
            left: 20px;
            top: 18px;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo-outer {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2), 
                        inset 0 -2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .logo-svg {
            width: 130px;
            height: 130px;
            object-fit: contain;
        }
        
        /* Stats bar */
        .stats-bar {
            width: 456px;
            height: 17px;
            left: 18px;
            top: 210px;
            position: absolute;
            background: #457D3C;
            box-shadow: 0px 4px 0px #224D21;
            border-radius: 4px 4px 0 0;
        }
        
        /* Usage section */
        .usage-section {
            width: 456px;
            height: 85px;
            left: 18px;
            top: 240px;
            position: absolute;
            background: #457D3C;
            box-shadow: 0px 4px 0px #224D21;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 15px;
        }
        .usage-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }
        .usage-item i {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .usage-value {
            font-size: 18px;
            font-weight: bold;
        }
        .usage-label {
            font-size: 10px;
            opacity: 0.8;
        }
        
        /* Subscription links */
        .sub-link {
            position: absolute;
            background: #040603;
            display: flex;
            align-items: center;
            padding: 0 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .sub-link:hover {
            background: #0a0d08;
        }
        .sub-link1 { width: 66px; height: 60px; left: 18px; top: 338px; justify-content: center; }
        .sub-link2 { width: 372px; height: 60px; left: 102px; top: 338px; justify-content: space-between; }
        .sub-link3 { width: 66px; height: 60px; left: 18px; top: 411px; justify-content: center; }
        .sub-link4 { width: 372px; height: 60px; left: 102px; top: 411px; justify-content: space-between; }
        
        .sub-icon {
            color: #D4D4D4;
            font-size: 32px;
        }
        .sub-text {
            color: #D4D4D4;
            font-size: 14px;
            flex: 1;
            margin: 0 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .sub-actions {
            display: flex;
            gap: 10px;
        }
        .sub-btn {
            background: none;
            border: 2px solid #D4D4D4;
            color: #D4D4D4;
            width: 35px;
            height: 35px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .sub-btn:hover {
            background: #D4D4D4;
            color: #040603;
        }
        .sub-btn i {
            font-size: 16px;
        }
        
        .divider {
            width: 456px;
            height: 13px;
            left: 18px;
            top: 480px;
            position: absolute;
            background: #040603;
        }
        
        /* Apps section */
        .apps-section {
            width: 456px;
            height: 85px;
            left: 18px;
            top: 506px;
            position: absolute;
            background: #457D3C;
            box-shadow: 0px 4px 0px #224D21;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 15px;
        }
        .app-icon {
            color: white;
            font-size: 40px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .app-icon:hover {
            transform: scale(1.1);
        }
        
        /* Team cards */
        .team-cards {
            position: absolute;
            left: 18px;
            top: 609px;
            width: 456px;
            display: flex;
            justify-content: space-between;
        }
        .team-card {
            width: 199px;
        }
        .team-card-img {
            width: 199px;
            height: 180px;
            background: linear-gradient(135deg, #2a4a2e 0%, #1a2a1e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            position: relative;
        }
        .team-card-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .team-card-img i {
            font-size: 80px;
            color: #457D3C;
            position: absolute;
        }
        .team-label {
            width: 199px;
            height: 23px;
            background: #040603;
            color: white;
            font-size: 11px;
            padding: 5px 6px;
            border-radius: 0 0 8px 8px;
        }
        
        /* Footer */
        .footer {
            width: 456px;
            height: 135px;
            left: 18px;
            top: 824px;
            position: absolute;
            background: linear-gradient(180deg, #C8C8C8 0%, #828581 20%, #383D37 40%, #20241E 60%, #141915 80%, #090B08 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            font-size: 12px;
            opacity: 0.7;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #457D3C;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }
        .notification.show {
            display: flex;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #2a2a2a;
            padding: 30px;
            border-radius: 12px;
            position: relative;
            max-width: 320px;
        }
        .modal-close {
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
        }
        .modal-close:hover {
            color: #fff;
        }
        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">
        <i class="bi bi-check-circle-fill" style="font-size: 20px;"></i>
        <span id="notificationText">Скопировано!</span>
    </div>

    <!-- QR Modal -->
    <div class="modal" id="qrModal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeQRModal()">&times;</span>
            <div id="qrcode"></div>
        </div>
    </div>

    <div class="container">
        <!-- Trees background -->
        <div class="tree tree1"></div>
        <div class="tree-shadow shadow1"></div>
        <div class="tree tree2"></div>
        <div class="tree-shadow shadow2"></div>
        <div class="tree tree3"></div>
        <div class="tree-shadow shadow3"></div>
        <div class="tree tree4"></div>
        <div class="tree-shadow shadow4"></div>
        <div class="tree tree5"></div>
        <div class="tree-shadow shadow5"></div>
        <div class="tree tree6"></div>
        <div class="tree-shadow shadow6"></div>
        <div class="ground-shadow"></div>
        
        <!-- Logo -->
        <div class="logo-container">
            <div class="logo-outer">
                <img class="logo-svg" src="https://raw.githubusercontent.com/hirzuko/Template/refs/heads/main/img/logo.svg" alt="VPN Logo">
            </div>
        </div>
        
        <!-- Stats bar -->
        <div class="stats-bar"></div>
        
        <!-- Usage section -->
        <div class="usage-section">
            <div class="usage-item">
                <i class="bi bi-arrow-up-circle-fill"></i>
                <div class="usage-value">{{ (user.used_traffic * 0.3) | bytesformat }}</div>
                <div class="usage-label">UPLOAD</div>
            </div>
            <div class="usage-item">
                <i class="bi bi-arrow-down-circle-fill"></i>
                <div class="usage-value">{{ (user.used_traffic * 0.7) | bytesformat }}</div>
                <div class="usage-label">DOWNLOAD</div>
            </div>
            <div class="usage-item">
                <i class="bi bi-database-fill"></i>
                <div class="usage-value">{{ user.used_traffic | bytesformat }}</div>
                <div class="usage-label">TOTAL</div>
            </div>
            <div class="usage-item">
                <i class="bi bi-calendar-check-fill"></i>
                {% if not user.expire %}
                <div class="usage-value">∞</div>
                <div class="usage-label">FOREVER</div>
                {% else %}
                {% set days_left = ((user.expire | int) - (now() | int)) // 86400 %}
                <div class="usage-value">{{ days_left }} дн.</div>
                <div class="usage-label">EXPIRES</div>
                {% endif %}
            </div>
        </div>
        
        <!-- Subscription link 1 -->
        {% if user.links and user.links|length > 0 %}
        <div class="sub-link sub-link1">
            <i class="bi bi-broadcast sub-icon"></i>
        </div>
        <div class="sub-link sub-link2">
            <span class="sub-text">{{ user.links[0] }}</span>
            <div class="sub-actions">
                <button class="sub-btn" onclick="copyLink('{{ user.links[0] }}')" title="Копировать">
                    <i class="bi bi-files"></i>
                </button>
                <button class="sub-btn" onclick="showQR('{{ user.links[0] }}')" title="QR код">
                    <i class="bi bi-qr-code-scan"></i>
                </button>
            </div>
        </div>
        {% endif %}
        
        <!-- Subscription link 2 -->
        {% if user.links and user.links|length > 1 %}
        <div class="sub-link sub-link3">
            <i class="bi bi-wifi sub-icon"></i>
        </div>
        <div class="sub-link sub-link4">
            <span class="sub-text">{{ user.links[1] }}</span>
            <div class="sub-actions">
                <button class="sub-btn" onclick="copyLink('{{ user.links[1] }}')" title="Копировать">
                    <i class="bi bi-files"></i>
                </button>
                <button class="sub-btn" onclick="showQR('{{ user.links[1] }}')" title="QR код">
                    <i class="bi bi-qr-code-scan"></i>
                </button>
            </div>
        </div>
        {% endif %}
        
        <!-- Divider -->
        <div class="divider"></div>
        
        <!-- Apps section -->
        <div class="apps-section">
            <i class="bi bi-apple app-icon" title="iOS"></i>
            <i class="bi bi-google-play app-icon" title="Android"></i>
            <i class="bi bi-windows app-icon" title="Windows"></i>
            <i class="bi bi-ubuntu app-icon" title="Linux"></i>
        </div>
        
        <!-- Team cards -->
        <div class="team-cards">
            <div class="team-card">
                <div class="team-card-img">
                    <img src="https://github.com/hirzuko/Template/blob/main/img/brodagi%20youre%20him.png?raw=true" alt="D-Infinitor" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px 8px 0 0;">
                </div>
                <div class="team-label">D-Infinitor - one of the designer team</div>
            </div>
            
            <div class="team-card">
                <div class="team-card-img">
                    <img src="https://github.com/hirzuko/Template/blob/main/img/me.jpg?raw=true" alt="Hirzuko" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px 8px 0 0;">
                </div>
                <div class="team-label">Hirzuko - main dev, admin, abuser</div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <i class="bi bi-lock-fill" style="font-size: 24px; margin-bottom: 10px;"></i>
            <div>Secure VPN Connection</div>
            <div style="font-size: 10px; margin-top: 5px;">© 2024 VPN Service</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
    <script>
        let qrCodeInstance = null;
        
        function copyLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                showNotification('Ссылка скопирована!');
            }).catch(() => {
                showNotification('Ошибка копирования', true);
            });
        }

        function showQR(link) {
            const modal = document.getElementById('qrModal');
            const qrcodeDiv = document.getElementById('qrcode');
            
            // Очищаем предыдущий QR код
            qrcodeDiv.innerHTML = '';
            
            // Создаем новый QR код
            qrCodeInstance = new QRCode(qrcodeDiv, {
                text: link,
                width: 256,
                height: 256,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            modal.style.display = 'flex';
        }
        
        function closeQRModal() {
            document.getElementById('qrModal').style.display = 'none';
        }
        
        // Закрытие модала по клику вне его
        window.onclick = function(event) {
            const modal = document.getElementById('qrModal');
            if (event.target == modal) {
                closeQRModal();
            }
        }

        function showNotification(text, isError = false) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = text;
            notification.style.background = isError ? '#c83c3c' : '#457D3C';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>